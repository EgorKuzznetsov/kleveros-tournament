<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Реєстрація — Dota 2 Cup</title>
  <link rel="icon" href="/assets/photo_2025-04-15_12-26-53.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter','ui-sans-serif'] } } } }
  </script>
</head>
<body class="bg-zinc-950 text-zinc-100">
<header class="sticky top-0 z-50 backdrop-blur bg-zinc-950/70 border-b border-white/5">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" class="font-semibold">← На головну</a>
    <a href="rules.html" class="text-sm text-zinc-300 hover:text-white">Правила</a>
  </div>
</header>

<main class="max-w-3xl mx-auto px-4 py-10">
  <h1 class="text-3xl font-extrabold">Реєстрація</h1>
  <p class="text-zinc-400 mt-2">Команда — вкажи назву, нік капітана і Telegram. Соло — нік, Telegram та MMR.</p>

  <form id="regForm" class="mt-8 space-y-6 bg-white/5 border border-white/10 rounded-2xl p-6" novalidate>
    <div class="grid md:grid-cols-2 gap-5">
      <div>
        <label class="block text-sm text-zinc-300 mb-1">Тип участі</label>
        <select name="join_type" id="join_type" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" required>
          <option value="team">Команда 5x5</option>
          <option value="solo">Соло</option>
        </select>
      </div>
      <div>
        <label class="block text-sm text-zinc-300 mb-1">Telegram для зв’язку</label>
        <input name="messenger" id="messenger" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" placeholder="@your_username" required>
      </div>
    </div>
<input type="text" name="honeypot" autocomplete="off" tabindex="-1" class="hidden" style="display:none;">
    <div class="grid md:grid-cols-2 gap-5">
      <div id="teamNameWrap">
        <label class="block text-sm text-zinc-300 mb-1">Назва команди</label>
        <input name="team_name" id="team_name" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" placeholder="Наприклад, Radiant Five">
      </div>
      <div>
        <label class="block text-sm text-zinc-300 mb-1">Нік (капітан / гравець)</label>
        <input name="player_nick" id="player_nick" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" placeholder="Наприклад, Dendi" required>
      </div>
    </div>
    <div id="mmrBlock" class="hidden">
      <label class="block text-sm text-zinc-300 mb-1">MMR (лише для соло)</label>
      <input name="mmr" id="mmr" type="number" min="0" step="1" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" placeholder="наприклад, 2500">
    </div>
    <div class="grid md:grid-cols-2 gap-5">
      <div>
        <label class="block text-sm text-zinc-300 mb-1">E-mail (необов’язково)</label>
        <input name="email" type="email" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" placeholder="name@email.com">
      </div>
      <div>
        <label class="block text-sm text-zinc-300 mb-1">Телефон (необов’язково)</label>
        <input name="phone" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" placeholder="+380...">
      </div>
    </div>
    <div id="teamRoster" class="">
      <label class="block text-sm text-zinc-300 mb-1">Склад команди (текстом, опційно)</label>
      <textarea name="roster_text" rows="3" class="w-full bg-zinc-900 border border-white/10 rounded-xl px-3 py-2" placeholder="Гравець 1, Гравець 2, Гравець 3, Гравець 4, Гравець 5"></textarea>
    </div>

    <div class="flex items-start gap-3">
      <input id="agree" type="checkbox" class="mt-1" required>
      <label for="agree" class="text-sm text-zinc-300">Я приймаю <a class="underline" href="rules.html">правила турніру</a>.</label>
    </div>
    <div style="gap: 20px;" class="flex">

      <button type="button" id="submitBtn" class="rounded-xl px-5 py-3 bg-indigo-600 hover:bg-indigo-500 transition">
        Надіслати заявку
      </button>
  
      <img id="load" style="width: 50px;" class="animate-spin hidden" src="./assets/loading-circles-blue-gradient.png" alt="">
    </div>
  </form>
</main>

<script>
  const API_BASE =
    location.hostname.includes("localhost") || location.hostname.startsWith("127.")
      ? "http://localhost:3000"
      : "https://kleveros-tournament.onrender.com";

  const joinTypeSel = document.getElementById('join_type');
  const mmrBlock    = document.getElementById('mmrBlock');
  const mmrInput    = document.getElementById('mmr');
  const teamRoster  = document.getElementById('teamRoster');
  const teamNameInp = document.getElementById('team_name');
  const load = document.getElementById('load')
  function toggleByType() {
    const isSolo = joinTypeSel.value === 'solo';
    mmrBlock.classList.toggle('hidden', !isSolo);
    teamRoster.classList.toggle('hidden', isSolo);
    if (isSolo) {
      mmrInput.setAttribute('required', 'required');
      teamNameInp.removeAttribute('required');
    } else {
      mmrInput.removeAttribute('required');
      teamNameInp.setAttribute('required', 'required');
    }
  }
  joinTypeSel.addEventListener('change', toggleByType);
  toggleByType();

  const submitBtn = document.getElementById('submitBtn');
  const form = document.getElementById('regForm');

  submitBtn.addEventListener('click', async () => {
    if (!form.reportValidity()) return;
    
    const fd = new FormData(form);
    const data = Object.fromEntries(fd.entries());
    const isSolo = data.join_type === 'solo';

    data.team_or_nick = isSolo ? (data.player_nick || '').trim() : (data.team_name || '').trim();
    if (!data.team_or_nick) {
      alert(isSolo ? 'Вкажи нік.' : 'Вкажи назву команди.');
      return;
    }
    if (isSolo) {
      if (!data.messenger?.trim()) return alert('Вкажи Telegram.');
      if (!data.mmr || Number(data.mmr) < 0) return alert('Вкажи коректний MMR.');
    }
    load.classList.remove('hidden')
    try {
      const resp = await fetch(`${API_BASE}/api/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const payload = await resp.text();
      if (!resp.ok) throw new Error(payload || 'Помилка сервера');

      window.location.href = 'success.html';
    } catch (err) {
      
    }
  });
</script>
</body>
</html>
